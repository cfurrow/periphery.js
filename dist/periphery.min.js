/*! Periphery.js - v0.1.0 - 2013-01-08
* http://cfurrow.github.com/periphery.js
* Copyright (c) 2013 Carl Furrow; Licensed MIT */
function deg2rad(e){return e*Math.PI/180}function rad2deg(e){return e*(180/Math.PI)}function distanceToClosestWallX(e,t){return deg2rad(t)>0&&deg2rad(t)<deg2rad(90)?ctx.canvas.width:deg2rad(t)>270&&deg2rad(t)<deg2rad(360)?ctx.canvas.width:deg2rad(t)>90&&deg2rad(t)<deg2rad(270)?0:e}function distanceToClosestWallY(e,t){return deg2rad(t)>deg2rad(235)&&deg2rad(t)<deg2rad(315)?0:deg2rad(t)>45&&deg2rad(t)<deg2rad(135)?ctx.canvas.height:e}function drawPeripheryVision(e,t){e.beginPath(),e.fillStyle="rgba(20,20,20,0.9)",t.periphery=[],e.moveTo(t.x,t.y),t.periphery.push(t.x,t.y);var n=t.x+t.visionRadius*Math.cos(t.direction-deg2rad(50)),r=t.y+t.visionRadius*Math.sin(t.direction-deg2rad(50));e.lineTo(n,r),t.periphery.push([n,r]),n=t.x+t.visionRadius*Math.cos(t.direction+deg2rad(50)),r=t.y+t.visionRadius*Math.sin(t.direction+deg2rad(50)),e.lineTo(n,r),t.periphery.push([n,r]),e.lineTo(t.x,t.y),e.closePath(),e.fill(),e.clip()}function drawCentralVision(e,t){e.beginPath(),e.fillStyle="rgba(200,200,200,0.9)",e.moveTo(t.x,t.y),t.central=[],t.central.push([t.x,t.y]);var n=t.x+t.visionRadius*Math.cos(t.direction-deg2rad(15)),r=t.y+t.visionRadius*Math.sin(t.direction-deg2rad(15));e.lineTo(n,r),t.central.push([n,r]),n=t.x+t.visionRadius*Math.cos(t.direction+deg2rad(15)),r=t.y+t.visionRadius*Math.sin(t.direction+deg2rad(15)),e.lineTo(n,r),t.central.push([n,r]),e.lineTo(t.x,t.y),e.closePath(),e.fill(),e.clip()}function drawPlayer(e,t){var n=t.x,r=t.y,i=t.direction;e.beginPath(),e.fillStyle="#ffffff",e.arc(n,r,playerRadius+2,0,Math.PI*2,!1),e.fill(),e.closePath(),e.beginPath(),e.fillStyle="#5e9fd2",e.arc(n,r,playerRadius,0,Math.PI*2,!1),e.fill(),e.closePath(),e.globalCompositeOperation="xor",drawPeripheryVision(e,t),e.save(),e.globalCompositeOperation="xor",drawCentralVision(e,t),e.restore()}function drawScene(e){var t=0,n=scene.length;for(;t<n;t++)scene[t].draw(e,enableShadows)}function handleMovement(e){e.movingForward&&(e.y+=e.velocity*2.5*Math.sin(e.direction),e.x+=e.velocity*2.5*Math.cos(e.direction)),e.movingBack&&(e.y-=e.velocity*2.5*Math.sin(e.direction),e.x-=e.velocity*2.5*Math.cos(e.direction)),e.turningRight&&(e.direction+=deg2rad(e.velocity),e.direction>deg2rad(360)&&(e.direction=0)),e.turningLeft&&(e.direction-=deg2rad(e.velocity),e.direction<deg2rad(0)&&(e.direction=deg2rad(360))),e.x=e.x-e.radius<0?e.radius:e.x,e.x=e.x+e.radius>ctx.canvas.width?ctx.canvas.width-e.radius:e.x,e.y=e.y-e.radius<0?e.radius:e.y,e.y=e.y+e.radius>ctx.canvas.height?ctx.canvas.height-e.radius:e.y}function frame(){ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),handleMovement(player),ctx.save(),drawPlayer(ctx,player),drawScene(player),ctx.restore(),ctx.fillStyle="#ffffff",ctx.font="20pt Helvetica",ctx.fillText(rad2deg(player.direction),10,20),requestAnimationFrame(frame)}var Shape=function(e,t){this.x=e,this.y=t,this.draw=function(){}},Rectangle=function(e,t,n,r,i,s){this.Shape=s.Shape,this.ctx=s.ctx,this.distanceToClosestWallY=s.distanceToClosestWallY,this.distanceToClosestWallX=s.distanceToClosestWallX,this.Shape.apply(this,arguments),this.width=n,this.height=r,this.fillStyle=i,this.points=[],this.shadows=!1,this.storePoints=function(){this.points=[],this.points.push(this.x,this.y),this.points.push(this.x+this.width,this.y),this.points.push(this.x+this.width,this.y+this.height),this.points.push(this.x,this.y+this.height)},this.draw=function(e,t){this.shadows=t,this.ctx.save(),this.ctx.fillStyle=this.fillStyle,this.storePoints(),this.ctx.fillRect(this.x,this.y,this.width,this.height),this.ctx.restore();if(this.shadows){var n,r;this.ctx.strokeStyle=this.ctx.fillStyle="#000000",this.ctx.beginPath(),this.ctx.moveTo(this.x,this.y),n=this.x+this.distanceToClosestWallX(this.x,e.direction)*Math.cos(e.direction),r=this.y+this.distanceToClosestWallY(this.y,e.direction)*Math.sin(e.direction),this.ctx.lineTo(n,r),n=this.x+this.width+this.distanceToClosestWallX(this.x,e.direction)*Math.cos(e.direction),r=this.y+this.distanceToClosestWallY(this.y,e.direction)*Math.sin(e.direction),this.ctx.lineTo(n,r),n=this.x+this.width,r=this.y+this.height,this.ctx.lineTo(n,r),n=this.x,r=this.y+this.height,this.ctx.lineTo(n,r),this.ctx.closePath(),this.ctx.fill()}}};Rectangle.prototype=new Shape;var Circle=function(e,t,n,r){Shape.apply(this,arguments),this.radius=n,this.fillStyle=r,this.draw=function(e){ctx.save(),ctx.fillStyle=this.fillStyle,ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,0,Math.PI*2,!1),ctx.closePath(),ctx.fill(),ctx.restore()}};Circle.prototype=new Shape;var MovingCircle=function(e,t,n,r){Circle.apply(this,arguments),this.velocity=5,this.movingdown=!1,this.movingup=!0,this.movingright=!1,this.movingleft=!0,this.move=function(){this.movingleft&&(this.x-=this.velocity),this.movingright&&(this.x+=this.velocity),this.movingup&&(this.y-=this.velocity),this.movingdown&&(this.y+=this.velocity),this.x<this.radius&&(this.movingleft=!1,this.movingright=!0),this.x>ctx.canvas.width-this.radius&&(this.movingright=!1,this.movingleft=!0),this.y<this.radius&&(this.movingup=!1,this.movingdown=!0),this.y>ctx.canvas.height-this.radius&&(this.movingup=!0,this.movingdown=!1)},this.draw=function(e){this.move(),ctx.save(),ctx.fillStyle=this.fillStyle,ctx.beginPath(),ctx.arc(this.x,this.y,this.radius,0,Math.PI*2,!1),ctx.closePath(),ctx.fill(),ctx.restore()}};MovingCircle.prototype=new Circle;var canvas=document.getElementById("c"),ctx=canvas.getContext("2d"),img=document.createElement("IMG"),playerRadius=10,FPS=60,width=0,height=0,scene=[],fillWindow=fillWindow===!1?!1:!0,enableShadows=!0;fillWindow&&(canvas.width=window.innerWidth,canvas.height=window.innerHeight),width=canvas.width,height=canvas.height;var player={x:width/2-playerRadius,y:height/2-playerRadius,direction:deg2rad(191),visionRadius:canvas.width*2,radius:playerRadius,velocity:3,turningLeft:!1,turningRight:!1,movingForward:!1,movingBack:!1,periphery:[[0,0],[0,0],[0,0]],central:[[0,0],[0,0],[0,0]]};scene.push(new Rectangle(10,10,50,50,"rgb(255,0,0)",this)),scene.push(new Rectangle(400,400,30,30,"rgb(0,255,0)",this)),scene.push(new Rectangle(500,10,90,90,"rgb(0,0,255)",this)),scene.push(new Circle(90,300,30,"rgb(255,100,0)",this)),scene.push(new MovingCircle(90,300,30,"rgb(10,200,250)",this)),document.onkeydown=function(e){var t=!1;return e.which===38&&(player.movingForward=!0,player.movingBack=!1,t=!0),e.which===40&&(player.movingBack=!0,player.movingForward=!1,t=!0),e.which===37&&(player.turningLeft=!0,player.turningRight=!1,t=!0),e.which===39&&(player.turningRight=!0,player.turningLeft=!1,t=!0),!t},document.onkeyup=function(e){return e.which===38&&(player.movingForward=!1),e.which===40&&(player.movingBack=!1),e.which===37&&(player.turningLeft=!1),e.which===39&&(player.turningRight=!1),e.which===83&&(enableShadows=!enableShadows),!1},window.onresize=function(){fillWindow&&(canvas.height=window.innerHeight,canvas.width=window.innerWidth,width=canvas.width,height=canvas.height,player.visionRadius=canvas.width*2)};var requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){setTimeout(e,1e3/FPS)};requestAnimationFrame(frame);